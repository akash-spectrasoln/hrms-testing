{% load static %}

{% block header %}
<header id="page-topbar">
    <div class="navbar-header">
        <div class="d-flex">
            <!-- LOGO -->
            <div class="navbar-brand-box">
                <a href="" class="logo logo-dark">
                    <span class="logo-sm">
                        <!-- Commented out problematic image reference -->
                        <!-- <img src="{% static 'images/min-logo.png' %}" alt="" height="30"> -->
                        <span class="placeholder-text">Logo</span>
                    </span>
                    <span class="logo-lg">
                        <!-- Commented out problematic image reference -->
                        <!-- <img src="{% static 'images/image001.png' %}" alt="" height="40"> -->
                        <span class="placeholder-text">Company Name</span>
                    </span>
                </a>

                <a href="" class="logo logo-light">
                    <span class="logo-sm">
                        <!-- Commented out problematic image reference -->
                        <!-- <img src="{% static 'images/min-logo.png' %}" alt="" height="30"> -->
                        <span class="placeholder-text">Logo</span>
                    </span>
                    <span class="logo-lg">
                        <!-- Commented out problematic image reference -->
                        <!-- <img src="{% static 'images/image001.png' %}" alt="" height="40"> -->
                        <span class="placeholder-text">Company Name</span>
                    </span>
                </a>
            </div>

            <button type="button" class="btn btn-sm px-3 font-size-16 header-item" id="vertical-menu-btn">
                <i class="fa fa-fw fa-bars"></i>
            </button>
        </div>

        <div class="d-flex">
            <!-- Dark/Light Mode Toggle -->
            <div class="dropdown">
                <button type="button" class="btn header-item" id="mode-setting-btn">
                    <i data-feather="moon" class="icon-lg layout-mode-dark"></i>
                    <i data-feather="sun" class="icon-lg layout-mode-light"></i>
                </button>
            </div>

            <!-- User Dropdown -->
            <div class="dropdown d-inline-block">
                <button type="button" class="btn header-item bg-soft-light border-start border-end"
                        id="page-header-user-dropdown"
                        data-bs-toggle="dropdown"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <img class="rounded-circle header-profile-user"
                         src="{% if user.profile_image_url %}{{ user.profile_image_url }}{% else %}{% static 'images/users/avatar-1.jpg' %}{% endif %}"
                         alt="">
                    <span class="d-none d-xl-inline-block ms-1 fw-medium">
                        {{user.emp_fname}}
                    </span>
                    <i class="mdi mdi-chevron-down d-none d-xl-inline-block"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-end">
                    <a class="dropdown-item" href="{% url 'profile' %}">
                        <i class="mdi mdi-face-profile font-size-16 align-middle me-1"></i> Profile
                    </a>
                    <a class="dropdown-item" href="">
                        <i class="mdi mdi-cog font-size-16 align-middle me-1"></i> Settings
                    </a>
                    <a class="dropdown-item" href="">
                        <i class="mdi mdi-logout font-size-16 align-middle me-1"></i> Logout
                    </a>
                </div>
            </div>

            <!-- Messages/Notifications -->
            {% if messages %}
            <div class="toast-container position-fixed" style="z-index: 9996; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                <div class="toast mb-2 position-relative"
                     style="background-color: rgb(122, 176, 201);"
                     role="alert"
                     aria-live="assertive"
                     aria-atomic="true"
                     data-bs-autohide="false">
                    <button type="button"
                            class="btn-close btn-close-white position-absolute top-0 end-0 mt-2 me-2"
                            data-bs-dismiss="toast"
                            aria-label="Close"></button>

                    <div class="d-flex align-items-center text-white border-0">
                        <div class="toast-body">
                            <ul class="mb-1">
                                {% for message in messages %}
                                    <li>{{ message }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</header>

<!-- Inline Styles for Placeholder -->
<style>
    .placeholder-text {
        font-weight: bold;
        color: #007bff;
        display: inline-block;
        padding: 5px 10px;
    }
</style>

<!-- Dark Mode Toggle Script -->
{% block header_scripts %}
<script>
(function($) {
    $(document).ready(function() {
        // Toast Initialization
        var toastElements = document.querySelectorAll('.toast');
        toastElements.forEach(function (toastElement) {
            var toast = new bootstrap.Toast(toastElement, { autohide: false });
            toast.show();
        });

        // Dark Mode Toggle
        $('#mode-setting-btn').on('click', function() {
            $.ajax({
                url: "",  // Ensure this URL is defined in your urls.py
                type: 'POST',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                success: function(data) {
                    if (data.is_dark_mode) {
                        $('html').attr('data-bs-theme', 'dark');
                        $('body').attr('data-sidebar', 'dark');
                        $('.layout-mode-dark').show();
                        $('.layout-mode-light').hide();
                    } else {
                        $('html').attr('data-bs-theme', 'light');
                        $('body').attr('data-sidebar', 'light');
                        $('.layout-mode-dark').hide();
                        $('.layout-mode-light').show();
                    }
                },
                error: function() {
                    alert("Failed to toggle dark mode.");
                }
            });
        });
    });
})(jQuery);
</script>
{% endblock header_scripts %}
{% endblock header %}