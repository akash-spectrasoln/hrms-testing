{% extends 'admin_partials/admin_base.html' %}
{% block body_class %}template-body-basic{% endblock %}
{% load static %}

{% block styles %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  /* Keep content clear of fixed sidebar and header */
  .content-wrapper { 
    margin-left: 70px; /* space for fixed sidebar */
    padding-top: 32px; /* reduced space for fixed header */
    transition: margin-left 0.3s;
  }

  @media (max-width: 575.98px) {
    .content-wrapper { 
      margin-left: 70px;
      padding-top: 28px; 
    }
  }

  .container { width: 100%; max-width: none; margin: 5px auto; padding: 0 5px; }
  .filter-section .form-control,
  .filter-section .form-select,
  .filter-section .btn {
    height: 28px !important;
    min-height: 28px !important;
    max-height: 28px !important;
    padding: 2px 6px !important;
    font-size: 0.8rem !important;
    line-height: 1.2 !important;
  }
  .filter-section .col { flex: 1 1 0 !important; min-width: 150px; }
  .client-card { border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.05); background: #fff; margin-top: 0.75rem; }
  .card-header { background-color: #0d6efd; color: white; padding: 0.5rem 0.75rem; border-radius: 10px 10px 0 0; display: flex; justify-content: space-between; align-items: center; }
  .card-title { font-size: 1rem; margin:0; flex-grow:1; text-align:center; }
  .form-label { font-size: 0.75rem; margin-bottom: 0.05rem !important; font-weight: 500; line-height:1.2; }
  .form-control, .form-select { font-size: 0.75rem !important; padding: 1px 4px !important; height:auto !important; line-height:1.3; margin-top:0px !important; }
  .filter-section { margin-bottom: 0.3rem !important; row-gap:0.4rem; }
  .filter-section .btn { font-size:0.75rem; padding:3px 8px; height:calc(1.5em + 6px); line-height:1.3; }
  .card-body { padding:0.6rem 0.8rem !important; }
  .btn { padding:2px 6px !important; font-size:0.78rem; }
  .table th, .table td { padding:0.2rem 0.4rem !important; font-size:0.75rem; vertical-align:middle; }
  .table th { font-weight:600; background-color:#f1f5f9; color:#075098; letter-spacing:0.3px; }
  .btn-sm { padding:2px 5px !important; font-size:0.75rem !important; }
  .btn i { margin-right:2px; }
  @media (max-width: 767.98px) {
    .card-header, .client-card { border-radius:0; }
    .card-title { font-size:0.95rem; }
    .filter-section { gap:0.25rem; }
    .btn { font-size:0.75rem !important; }
  }
</style>
{% endblock %}

{% block content %}
<div class="content-wrapper">
<div class="container">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-11 col-xl-10">
      <div class="client-card mt-3 mb-4">

        <!-- Header -->
        <div class="card-header">
          <h2 class="card-title mb-0">Client List</h2>
          <a href="{% url 'client_create' %}?next={{ request.get_full_path|urlencode }}" class="btn btn-success btn-sm ms-2 me-3">
            <i class="fas fa-plus"></i> Add Client
          </a>

          <a href="{% url 'admin_index' %}" class="btn-close btn-close-white" aria-label="Close"></a>
        </div>

        <div class="card-body">
          <!-- Filter Form -->
          <form method="get" class="row g-2 filter-section align-items-end">
            <div class="col-12 col-sm-6 col-md-3 col">
              <label for="searchInput" class="form-label">Search</label>
              <input type="text" id="searchInput" name="search" class="form-control"
                     placeholder="Name or Address" value="{{ search_query }}">
            </div>

            <div class="col-sm-6 col-md-2 col">
              <label for="aliasSelect" class="form-label">Abbreviation</label>
              <select id="aliasSelect" name="alias" class="form-select">
                <option value="">All</option>
                {% for abbreviation in abbreviations %}
                  <option value="{{ abbreviation }}" {% if alias_filter == abbreviation %}selected{% endif %}>
                    {{ abbreviation }}
                  </option>
                {% endfor %}
              </select>
            </div>

            <div class="col-sm-6 col-md-3 col">
              <label for="countrySelect" class="form-label">Country</label>
              <select id="countrySelect" name="country" class="form-select">
                <option value="">All</option>
                {% for c in countries %}
                  <option value="{{ c.pk }}" {% if country_filter == c.pk|stringformat:"s" %}selected{% endif %}>
                    {{ c.country_name }}
                  </option>
                {% endfor %}
              </select>
            </div>

            <div class="col-sm-6 col-md-2 col">
              <label for="statusSelect" class="form-label">Status</label>
              <select id="statusSelect" name="status" class="form-select">
                <option value="">All</option>
                <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active</option>
                <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>Inactive</option>
              </select>
            </div>

            <div class="col-sm-6 col-md-2 col">
              <label for="sortSelect" class="form-label">Sort</label>
              <select id="sortSelect" name="sort" class="form-select">
                {% for value, label in sort_options %}
                  <option value="{{ value }}" {% if sort_field == value %}selected{% endif %}>
                    {{ label }}
                  </option>
                {% endfor %}
              </select>
            </div>

            <div class="col-sm-6 col-md-2 col">
              <button type="submit" class="btn btn-primary w-100">
               Search
              </button>
            </div>
          </form>

          <!-- Client Table -->
          <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Abbreviation</th>
                  <th>Address</th>
                  <th>Country</th>
                  <th>Status</th> <!-- NEW -->
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for client in clients %}
                  <tr>
                    <td>{{ client.client_name }}</td>
                    <td>{{ client.client_alias }}</td>
                    <td>{{ client.client_addr }}</td>
                    <td>{{ client.country.country_name }}</td>
                    <td>
                      {% if client.is_active %}
                        <span class="badge bg-success">Active</span>
                      {% else %}
                        <span class="badge bg-secondary">Inactive</span>
                      {% endif %}
                    </td>
                    <td>
                      <div class="d-flex gap-2 mr-2" role="group">
                        <a href="{% url 'client_update' client.client_id %}?next={{ request.get_full_path|urlencode }}" class="btn btn-sm btn-primary" title="Edit">
                          <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'client_delete' client.client_id %}?next={{ request.get_full_path|urlencode }}" class="btn btn-sm btn-danger" title="Delete">
                          <i class="fas fa-trash"></i>
                        </a>
                      </div>
                    </td>
                  </tr>
                {% empty %}
                  <tr>
                    <td colspan="6" class="text-center text-muted">No clients found.</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div> <!-- card-body -->
      </div>
    </div>
  </div>
</div>
</div>
{% endblock %}
